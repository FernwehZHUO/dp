<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Programming: Weighted Interval Scheduling</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .phase-indicator {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
            transition: background 0.5s ease;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .control-group {
            flex: 1;
            min-width: 300px;
        }
        
        .control-group h3 {
            color: #444;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }
        
        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        input[type="range"] {
            width: 200px;
        }
        
        textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
        }
        
        .visualization {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .panel h3 {
            color: #444;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        #timeline {
            position: relative;
            height: 350px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: linear-gradient(to right, #f0f0f0 1px, transparent 1px);
            background-size: 40px 100%;
            overflow-x: auto;
            overflow-y: hidden;
        }
        
        .interval {
            position: absolute;
            height: 40px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            opacity: 0.9;
            border: 3px solid transparent;
        }
        
        .interval:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 1;
        }
        
        .interval.selected {
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            z-index: 10;
        }
        
        .interval.considering {
            animation: pulse 1s infinite;
            border-color: #00ff00;
            z-index: 5;
        }
        
        .interval.backtrack-current {
            animation: backtrackPulse 1s infinite;
            border-color: #ff00ff;
            z-index: 15;
        }
        
        .interval.excluded {
            opacity: 0.3;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }
        
        @keyframes backtrackPulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 0, 255, 0.8);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 0, 255, 1);
                transform: scale(1.1);
            }
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        
        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        tr.highlight {
            background: #fff3cd !important;
            transition: background 0.5s ease;
        }
        
        tr.backtrack-highlight {
            background: #ffe0ff !important;
            transition: background 0.5s ease;
        }
        
        .decision-source {
            background-color: #c8e6c9 !important;
            font-weight: bold;
        }
        
        .formula {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
        }
        
        .explanation {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            min-height: 80px;
            line-height: 1.6;
        }
        
        .backtrack-explanation {
            background: #fce4ec;
            border-left: 4px solid #e91e63;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            min-height: 80px;
            line-height: 1.6;
        }
        
        .backtrack-path {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .stat-card h4 {
            font-size: 0.9em;
            margin-bottom: 5px;
            opacity: 0.9;
        }
        
        .stat-card .value {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
        }
        
        footer a {
            color: #667eea;
            font-weight: bold;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        footer a:hover {
            color: #764ba2;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 Weighted Interval Scheduling</h1>
        <p class="subtitle">Dynamic Programming Visualization with Step-by-Step Backtracking</p>
        
        <div class="phase-indicator" id="phaseIndicator">
            📚 Phase: Setup - Load your data to begin
        </div>
        
        <div class="controls">
            <div class="control-group">
                <h3>📊 Input Data</h3>
                <textarea id="inputData" placeholder="Format: start,end,value (one per line)
Example:
0,3,2
1,5,4
4,6,4
2,8,7
7,9,2
7,9,1">0,3,2
1,5,4
4,6,4
2,8,7
7,9,2
7,9,1</textarea>
                <div class="button-group">
                    <button onclick="loadData()">📥 Load Data</button>
                    <button onclick="loadRandomData()">🎲 Generate Random</button>
                </div>
            </div>
            
            <div class="control-group">
                <h3>🎮 Algorithm Controls</h3>
                <div class="button-group">
                    <button onclick="startAlgorithm()" id="startBtn">▶️ Start Algorithm</button>
                    <button onclick="stepAlgorithm()" id="stepBtn" disabled>⏭️ Next Step</button>
                    <button onclick="runToEnd()" id="runBtn" disabled>⏩ Run to End</button>
                    <button onclick="reset()">🔄 Reset</button>
                </div>
                
                <h4 style="margin-top: 15px;">🔙 Backtracking Controls</h4>
                <div class="button-group">
                    <button onclick="startBacktracking()" id="backtrackStartBtn" disabled>🎯 Start Backtrack</button>
                    <button onclick="stepBacktrack()" id="backtrackStepBtn" disabled>⏭️ Next Backtrack</button>
                    <button onclick="runBacktrackToEnd()" id="backtrackRunBtn" disabled>⏩ Complete Backtrack</button>
                </div>
                
                <div class="speed-control">
                    <label>Animation Speed:</label>
                    <input type="range" id="speed" min="100" max="2000" value="800">
                    <span id="speedValue">800ms</span>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item"><div class="legend-color" style="border: 3px solid #00ff00;"></div><span>Computing</span></div>
            <div class="legend-item"><div class="legend-color" style="border: 3px solid #ff00ff;"></div><span>Backtracking</span></div>
            <div class="legend-item"><div class="legend-color" style="border: 3px solid #FFD700;"></div><span>In Solution</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #ccc; opacity: 0.5;"></div><span>Excluded</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #c8e6c9;"></div><span>Winning Value</span></div>
        </div>
        
        <div class="visualization">
            <div class="panel">
                <h3>📅 Timeline Visualization</h3>
                <div id="timeline"><div class="timeline-labels"></div></div>
            </div>
            <div class="panel">
                <h3>📋 Interval Data & p(j) Values</h3>
                <div style="max-height: 350px; overflow-y: auto;">
                    <table id="dataTable">
                        <thead><tr><th>i</th><th>Start</th><th>End</th><th>Value</th><th>p(i)</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h3>🧮 Dynamic Programming Computation</h3>
            <div class="formula">OPT(j) = max{ OPT(j-1), v<sub>j</sub> + OPT(p<sub>j</sub>) }</div>
            <div class="explanation" id="currentStep">Click "Load Data" and then "Start Algorithm" to begin.</div>
            <div style="overflow-x: auto;">
                <table id="dpTable">
                    <thead><tr><th>j</th><th>p(j)</th><th>OPT(j-1)</th><th>v<sub>j</sub> + OPT(p<sub>j</sub>)</th><th>OPT(j)</th><th>Decision</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        
        <div class="panel">
            <h3>🎯 Solution Backtracking</h3>
            <div class="backtrack-explanation" id="backtrackExplanation">After computing all OPT values, the optimal solution will be reconstructed here.</div>
            <div class="backtrack-path" id="backtrackPath"></div>
            <div class="stats" id="statistics" style="display: none;">
                <div class="stat-card"><h4>Total Intervals</h4><div class="value" id="statTotal">0</div></div>
                <div class="stat-card"><h4>Selected</h4><div class="value" id="statSelected">0</div></div>
                <div class="stat-card"><h4>Optimal Value</h4><div class="value" id="statValue">0</div></div>
                <div class="stat-card"><h4>Efficiency</h4><div class="value" id="statEfficiency">0%</div></div>
            </div>
        </div>

        <footer>
            <p>
                Created by <a href="https://github.com/FernwehZHUO" target="_blank" rel="noopener noreferrer">FernwehZHUO</a>
            </p>
        </footer>

    </div>
    
    <script>
        let intervals = [];
        let sortedIntervals = [];
        let p = [];
        let opt = [];
        let decisions = [];
        let currentStep = -1;
        let isRunning = false;
        let solution = [];
        let currentBacktrackStep = -1;
        let phase = 'setup'; // 'setup', 'computing', 'backtracking', 'complete'

        window.onload = loadData;
        
        document.getElementById('speed').addEventListener('input', function() {
            document.getElementById('speedValue').textContent = this.value + 'ms';
        });
        
        function updatePhaseIndicator() {
            const indicator = document.getElementById('phaseIndicator');
            switch(phase) {
                case 'setup':
                    indicator.textContent = '📚 Phase: Setup - Load data or use the example to begin';
                    indicator.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                    break;
                case 'computing':
                    indicator.textContent = `🧮 Phase: Computing OPT Values - Step ${currentStep + 1} of ${sortedIntervals.length}`;
                    indicator.style.background = 'linear-gradient(135deg, #4caf50, #8bc34a)';
                    break;
                case 'backtracking':
                    indicator.textContent = `🔙 Phase: Backtracking - Finding Optimal Solution`;
                    indicator.style.background = 'linear-gradient(135deg, #f093fb, #f5576c)';
                    break;
                case 'complete':
                    indicator.textContent = '✅ Phase: Complete - Optimal Solution Found!';
                    indicator.style.background = 'linear-gradient(135deg, #ffd700, #ffb700)';
                    break;
            }
        }

        function setButtonsState(start, step, run, b_start, b_step, b_run) {
            document.getElementById('startBtn').disabled = !start;
            document.getElementById('stepBtn').disabled = !step;
            document.getElementById('runBtn').disabled = !run;
            document.getElementById('backtrackStartBtn').disabled = !b_start;
            document.getElementById('backtrackStepBtn').disabled = !b_step;
            document.getElementById('backtrackRunBtn').disabled = !b_run;
        }
        
        function loadData() {
            reset();
            const input = document.getElementById('inputData').value.trim();
            if (!input) return;
            
            intervals = input.split('\n').map((line, index) => {
                const parts = line.trim().split(',');
                return { id: index + 1, start: parseFloat(parts[0]), end: parseFloat(parts[1]), value: parseFloat(parts[2]) };
            }).filter(i => !isNaN(i.start) && !isNaN(i.end) && !isNaN(i.value));
            
            if (intervals.length === 0) return;
            
            preprocessIntervals();
            visualizeIntervals();
            updateDataTable();
            setButtonsState(true, false, false, false, false, false);
        }
        
        function loadRandomData() {
            const n = 6 + Math.floor(Math.random() * 5);
            let tempIntervals = [];
            for (let i = 0; i < n; i++) {
                const start = Math.floor(Math.random() * 15);
                const duration = 2 + Math.floor(Math.random() * 6);
                const value = 1 + Math.floor(Math.random() * 9);
                tempIntervals.push({ start, end: Math.min(start + duration, 20), value });
            }
            document.getElementById('inputData').value = tempIntervals.map(i => `${i.start},${i.end},${i.value}`).join('\n');
            loadData();
        }
        
        function preprocessIntervals() {
            sortedIntervals = [...intervals].sort((a, b) => a.end - b.end);
            p = [0]; // p[0] is a dummy value for 1-based indexing
            sortedIntervals.forEach((interval_j, j_idx) => {
                let pj = 0;
                for (let i_idx = j_idx - 1; i_idx >= 0; i_idx--) {
                    if (sortedIntervals[i_idx].end <= interval_j.start) {
                        pj = i_idx + 1;
                        break;
                    }
                }
                p.push(pj);
            });
        }
        
        function visualizeIntervals() {
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '<div class="timeline-labels"></div>';
            
            const maxTime = Math.max(1, ...intervals.map(i => i.end));
            const scale = 40;
            
            const labelsDiv = timeline.querySelector('.timeline-labels');
            for (let t = 0; t <= maxTime; t++) {
                const label = document.createElement('div');
                label.style.position = 'absolute';
                label.style.left = (t * scale) + 'px';
                label.style.bottom = '5px';
                label.style.fontSize = '12px';
                label.textContent = t;
                labelsDiv.appendChild(label);
            }
            
            sortedIntervals.forEach((interval, index) => {
                const div = document.createElement('div');
                div.className = 'interval';
                div.id = `interval-${index}`;
                div.style.left = (interval.start * scale) + 'px';
                div.style.width = ((interval.end - interval.start) * scale - 4) + 'px';
                div.style.top = (20 + index * 45) + 'px';
                div.style.background = `hsl(${index * 360/sortedIntervals.length}, 70%, 50%)`;
                div.innerHTML = `<span>${index + 1} (v=${interval.value})</span>`;
                div.title = `Interval ${index + 1}: [${interval.start}, ${interval.end}], v=${interval.value}, p(${index + 1})=${p[index + 1]}`;
                timeline.appendChild(div);
            });
            timeline.style.minWidth = ((maxTime + 1) * scale) + 'px';
        }
        
        function updateDataTable() {
            const tbody = document.querySelector('#dataTable tbody');
            tbody.innerHTML = '';
            sortedIntervals.forEach((interval, index) => {
                const row = tbody.insertRow();
                row.id = `data-row-${index}`;
                row.innerHTML = `<td>${index + 1}</td><td>${interval.start}</td><td>${interval.end}</td><td>${interval.value}</td><td>${p[index + 1]}</td>`;
            });
        }
        
        function reset() {
            isRunning = false;
            phase = 'setup';
            currentStep = -1;
            currentBacktrackStep = -1;
            opt = [0];
            decisions = [''];
            solution = [];
            
            document.querySelectorAll('.interval').forEach(el => el.className = 'interval');
            document.querySelectorAll('#dataTable tr, #dpTable tr').forEach(row => row.classList.remove('highlight', 'backtrack-highlight'));
            document.querySelector('#dpTable tbody').innerHTML = '';
            document.getElementById('backtrackPath').innerHTML = '';
            
            document.getElementById('currentStep').innerHTML = 'Click "Start Algorithm" to begin.';
            document.getElementById('backtrackExplanation').innerHTML = 'Backtracking results will appear here.';
            document.getElementById('statistics').style.display = 'none';

            setButtonsState(intervals.length > 0, false, false, false, false, false);
            updatePhaseIndicator();
        }
        
        function startAlgorithm() {
            if (intervals.length === 0) return;
            reset();
            phase = 'computing';
            setButtonsState(false, true, true, false, false, false);
            stepAlgorithm();
        }

        async function runToEnd() {
            isRunning = true;
            setButtonsState(false, false, false, false, false, false);
            while (isRunning && currentStep < sortedIntervals.length - 1) {
                stepAlgorithm();
                const delay = document.getElementById('speed').value;
                await new Promise(resolve => setTimeout(resolve, delay));
            }
            isRunning = false;
        }
        
        function stepAlgorithm() {
            if (currentStep >= sortedIntervals.length - 1) {
                enableBacktracking();
                return;
            }
            currentStep++;
            updatePhaseIndicator();
            computeOPT(currentStep + 1);
        }
        
        function computeOPT(j) {
            const interval = sortedIntervals[j - 1];
            const pj = p[j];
            
            document.querySelectorAll('.interval.considering').forEach(el => el.classList.remove('considering'));
            document.getElementById(`interval-${j - 1}`).classList.add('considering');
            
            document.querySelectorAll('#dataTable tr.highlight').forEach(row => row.classList.remove('highlight'));
            document.getElementById(`data-row-${j - 1}`).classList.add('highlight');
            
            const option1 = opt[j - 1]; // Skip interval j
            const option2 = opt[pj] + interval.value; // Take interval j
            
            opt[j] = Math.max(option1, option2);
            decisions[j] = (option2 > option1) ? 'take' : 'skip';
            
            document.getElementById('currentStep').innerHTML = `
                <b>Computing OPT(${j}):</b>
                <ul>
                    <li>Option 1 (Skip interval ${j}): Value = OPT(${j-1}) = <b>${option1}</b></li>
                    <li>Option 2 (Take interval ${j}): Value = v<sub>${j}</sub> + OPT(p<sub>${j}</sub>) = ${interval.value} + OPT(${pj}) = <b>${option2}</b></li>
                </ul>
                Decision: <b>${decisions[j].charAt(0).toUpperCase() + decisions[j].slice(1)}</b>. OPT(${j}) is set to <b>${opt[j]}</b>.`;

            const dpTbody = document.querySelector('#dpTable tbody');
            const row = dpTbody.insertRow();
            row.id = `dp-row-${j}`;
            const decisionClass = decisions[j] === 'take' ? 'decision-source' : '';
            const skipClass = decisions[j] === 'skip' ? 'decision-source' : '';

            row.innerHTML = `
                <td>${j}</td>
                <td>${pj}</td>
                <td class="${skipClass}">${option1}</td>
                <td class="${decisionClass}">${option2}</td>
                <td><b>${opt[j]}</b></td>
                <td>${decisions[j]}</td>
            `;
            row.classList.add('highlight');
            setTimeout(() => row.classList.remove('highlight'), 1000);
        }
        
        function enableBacktracking() {
            phase = 'backtracking';
            updatePhaseIndicator();
            setButtonsState(false, false, false, true, false, false);
            document.getElementById('currentStep').innerHTML = 'Computation complete. Ready for backtracking.';
            document.querySelectorAll('.interval.considering').forEach(el => el.classList.remove('considering'));
        }

        function startBacktracking() {
            currentBacktrackStep = sortedIntervals.length;
            solution = [];
            document.getElementById('backtrackPath').innerHTML = '<h4>Optimal Solution Path:</h4>';
            phase = 'backtracking';
            setButtonsState(false, false, false, false, true, true);
            stepBacktrack();
        }

        async function runBacktrackToEnd() {
            isRunning = true;
            setButtonsState(false, false, false, false, false, false);
            while (isRunning && currentBacktrackStep > 0) {
                stepBacktrack();
                const delay = document.getElementById('speed').value;
                await new Promise(resolve => setTimeout(resolve, delay));
            }
            isRunning = false;
        }

        function stepBacktrack() {
            if (currentBacktrackStep <= 0) {
                phase = 'complete';
                updatePhaseIndicator();
                updateStatistics();
                setButtonsState(false, false, false, false, false, false);
                document.getElementById('backtrackExplanation').innerHTML = `<b>Backtracking Complete!</b> The optimal set of intervals has been found.`;
                document.querySelectorAll('.interval.backtrack-current').forEach(el => el.classList.remove('backtrack-current'));
                
                sortedIntervals.forEach((interval, index) => {
                    if (!solution.includes(interval)) {
                        document.getElementById(`interval-${index}`).classList.add('excluded');
                    }
                });
                return;
            }

            const j = currentBacktrackStep;
            const interval = sortedIntervals[j - 1];
            
            document.querySelectorAll('.interval.backtrack-current').forEach(el => el.classList.remove('backtrack-current'));
            document.getElementById(`interval-${j-1}`).classList.add('backtrack-current');

            document.querySelectorAll('#dpTable tr.backtrack-highlight').forEach(row => row.classList.remove('backtrack-highlight'));
            document.getElementById(`dp-row-${j}`).classList.add('backtrack-highlight');

            let explanationText;
            const pathDiv = document.createElement('div');

            if (decisions[j] === 'take') {
                solution.unshift(interval);
                document.getElementById(`interval-${j-1}`).classList.add('selected');
                
                explanationText = `Examining <b>j=${j}</b>. Decision was to <b>TAKE</b>. <ul><li>Interval ${j} is added to the solution.</li><li>We now <b>JUMP</b> to the last compatible subproblem, which is <b>p(${j}) = ${p[j]}</b>.</li></ul>`;
                pathDiv.innerHTML = `<b>j=${j}</b>: Take interval ${j}. Jump to j=${p[j]}.`;

                for (let i = j - 2; i >= p[j]; i--) {
                    document.getElementById(`interval-${i}`).classList.add('excluded');
                }

                currentBacktrackStep = p[j];
            } else {
                document.getElementById(`interval-${j-1}`).classList.add('excluded');
                
                explanationText = `Examining <b>j=${j}</b>. Decision was to <b>SKIP</b>. <ul><li>Interval ${j} is not in the solution.</li><li>We continue to the next smaller subproblem, <b>j-1 = ${j-1}</b>.</li></ul>`;
                pathDiv.innerHTML = `<b>j=${j}</b>: Skip interval ${j}. Move to j=${j-1}.`;
                
                currentBacktrackStep = j - 1;
            }

            document.getElementById('backtrackExplanation').innerHTML = explanationText;
            document.getElementById('backtrackPath').appendChild(pathDiv);
        }

        function updateStatistics() {
            const totalValue = solution.reduce((sum, i) => sum + i.value, 0);
            const totalPossibleValue = intervals.reduce((sum, i) => sum + i.value, 0);
            const valueEfficiency = totalPossibleValue > 0 ? (totalValue / totalPossibleValue * 100).toFixed(1) : 0;
            
            document.getElementById('statTotal').textContent = intervals.length;
            document.getElementById('statSelected').textContent = solution.length;
            document.getElementById('statValue').textContent = totalValue;
            document.getElementById('statEfficiency').textContent = `${valueEfficiency}%`;
            document.getElementById('statistics').style.display = 'grid';
        }

    </script>
</body>
</html>